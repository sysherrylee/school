<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ ¡åœ’é€šçŸ¥å–®ç”¢ç”Ÿå™¨ - æ´»å‹•èªªæ˜å¢å¼·ç‰ˆ</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
    crossorigin="anonymous"></script>

  <style>
    @media print {
      .no-print {
        display: none;
      }
    }

    .notice-content {
      line-height: 1.6;
      font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
    }

    #preview {
      width: 210mm;
      height: 297mm;
      box-sizing: border-box;
      overflow: hidden;
      background: #fff;
      margin: 0 auto;
      padding: 15mm 18mm;
      display: flex;
      flex-direction: column;
    }

    .upload-area {
      border: 2px dashed #cbd5e0;
      transition: all .25s;
    }

    .upload-area:hover {
      border-color: #4299e1;
      background: #ebf8ff;
    }

    #pdfMount {
      position: fixed;
      left: 0;
      top: 0;
      width: 210mm;
      height: 297mm;
      z-index: 99999;
      background: white;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>

<body class="bg-gray-100 p-4">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6 text-gray-800 no-print">æ ¡åœ’é€šçŸ¥å–®ç”¢ç”Ÿå™¨</h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white rounded-lg shadow-lg p-6 no-print">
        <h2 class="text-xl font-semibold mb-4 text-gray-700 border-b pb-2">å¡«å¯«é€šçŸ¥å–®è³‡è¨Š</h2>

        <div class="space-y-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">å­¸æ ¡åç¨±</label>
              <input type="text" id="schoolName" value="å»ºåŠŸåœ‹å°"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">æ´»å‹•åç¨±</label>
              <input type="text" id="activityName" value="é«˜å¹´ç´šå±±é‡æ•™è‚²é«”é©—æ´»å‹•"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ä¸€ã€æ´»å‹•èªªæ˜ (å®—æ—¨/ç°¡ä»‹)</label>
            <textarea id="activityIntro" rows="2"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              placeholder="ä¾‹å¦‚ï¼šç‚ºå¢é€²å­¸ç”Ÿå°å±±é‡ç’°å¢ƒçš„èªè­˜ï¼ŒåŸ¹é¤Šåœ˜é«”åˆä½œèˆ‡å•é¡Œè§£æ±ºèƒ½åŠ›..."></textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">äºŒã€æ´»å‹•æ™‚é–“èªªæ˜</label>
            <textarea id="timeDesc" rows="2"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">ä¸‰ã€æ´»å‹•è¡Œç¨‹è¡¨ (åœ–ç‰‡)</label>
            <div class="upload-area rounded-lg p-4 text-center cursor-pointer" id="uploadArea">
              <input type="file" id="scheduleImage" accept="image/*" class="hidden">
              <p class="text-sm text-gray-600">é»æ“Šæˆ–æ‹–æ›³ä¸Šå‚³åœ–ç‰‡</p>
            </div>
            <div id="imagePreview" class="mt-2 hidden flex items-center justify-between bg-gray-50 p-2 rounded">
              <span class="text-xs text-gray-500">å·²è¼‰å…¥è¡Œç¨‹åœ–</span>
              <button type="button" onclick="removeImage()" class="text-xs text-red-600 font-bold">ç§»é™¤åœ–ç‰‡</button>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">å››ã€æ³¨æ„äº‹é …</label>
            <textarea id="notes" rows="3"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
          </div>

          <div class="bg-blue-50 p-4 rounded-lg space-y-4 border border-blue-200">
            <h3 class="text-sm font-bold text-blue-800">ğŸ“ ç‰ˆé¢å¾®èª¿ (æ‹‰å‹•å¯å¡«æ»¿ A4)</h3>
            <div class="grid grid-cols-1 gap-3">
              <div>
                <label class="flex justify-between text-xs text-gray-600 mb-1">
                  <span>æ•´é«”å­—é«”å¤§å°</span> <span id="fsVal">14px</span>
                </label>
                <input type="range" id="fontSizeRange" min="12" max="22" value="14" class="w-full">
              </div>
              <div>
                <label class="flex justify-between text-xs text-gray-600 mb-1">
                  <span>å…§å®¹è¡Œè·</span> <span id="lhVal">1.6</span>
                </label>
                <input type="range" id="lineHeightRange" min="12" max="35" value="16" class="w-full">
              </div>
              <div>
                <label class="flex justify-between text-xs text-gray-600 mb-1">
                  <span>è¡Œç¨‹åœ–ç‰‡ç¸®æ”¾ (%)</span> <span id="imgWVal">100%</span>
                </label>
                <input type="range" id="imgWidthRange" min="30" max="100" value="100" class="w-full">
              </div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 text-red-600 font-bold">æˆªæ­¢æ—¥æœŸ</label>
              <input type="text" id="deadline" value="10/23" class="w-full px-4 py-2 border border-red-200 rounded-lg">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1 text-red-600 font-bold">è¯çµ¡é›»è©±</label>
              <input type="text" id="phone" value="(06)7880114"
                class="w-full px-4 py-2 border border-red-200 rounded-lg">
            </div>
          </div>

          <button id="downloadBtn"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition duration-200">
            ä¸‹è¼‰æ­£å¼ PDF é€šçŸ¥å–®
          </button>
        </div>
      </div>

      <div class="bg-gray-300 rounded-lg shadow-inner p-4 overflow-auto flex justify-center">
        <div id="preview" class="border shadow-2xl notice-content" style="font-size: 14px;">
          <div id="previewInner" class="h-full flex flex-col">
            <div class="text-center font-bold mb-4" id="previewTitle"
              style="font-size: 18px; border-bottom: 2px solid #000; padding-bottom: 8px;">
              ã€<span id="previewSchool">å»ºåŠŸåœ‹å°</span> <span id="previewActivity">æ´»å‹•</span> é€šçŸ¥å–®æš¨å®¶é•·åŒæ„æ›¸ã€‘
            </div>

            <div class="flex-grow">
              <div class="section-content mb-3">
                <div class="font-bold">ä¸€ã€æ´»å‹•èªªæ˜ï¼š</div>
                <div id="previewIntro" class="pl-4 text-gray-800"></div>
              </div>

              <div class="section-content mb-3">
                <div class="font-bold">äºŒã€æ´»å‹•æ™‚é–“ï¼š</div>
                <div id="previewTime" class="pl-4 text-gray-800"></div>
              </div>

              <div class="section-content mb-3">
                <div class="font-bold">ä¸‰ã€æ´»å‹•è¡Œç¨‹ï¼š</div>
                <div id="scheduleImageContainer" class="py-2 flex justify-center">
                  <p class="text-gray-400 text-sm italic">æœªä¸Šå‚³åœ–ç‰‡</p>
                </div>
              </div>

              <div class="section-content mb-3">
                <div class="font-bold">å››ã€æ³¨æ„äº‹é …ï¼š</div>
                <div id="notesList" class="pl-4 text-gray-800"></div>
              </div>
            </div>

            <div class="mt-auto">
              <div style="border-top: 2px dashed #000; margin: 12px 0;"></div>
              <div class="text-center mb-4 font-bold" style="letter-spacing: 4px; font-size: 13px;">
                â”€â”€â”€â”€â”€â”€â”€ å› â”€â”€â”€â”€â”€â”€ æ¢ â”€â”€â”€â”€â”€â”€ å–® â”€â”€â”€â”€â”€â”€â”€
              </div>

              <div class="mb-5 space-y-1 text-lg">
                <div class="font-medium">â–¡ èŒ²åŒæ„ ( )å¹´ç”²ç­ _________ åŒå­¸åƒåŠ æ–¼ <span id="replyActivity"
                    class="underline"></span>ã€‚</div>
                <div>â–¡ ç„¡æ³•åƒåŠ ï¼Œè¾¦ç†è«‹å‡ï¼ŒæœŸé–“æœƒåœ¨å®¶è‡ªè¡Œæº«ç¿’åŠŸèª²ã€‚</div>
                <div>â–¡ ç„¡æ³•åƒåŠ ï¼Œç•¶æ—¥åˆ°æ ¡ã€‚</div>
              </div>

              <div class="flex justify-between items-end border-t border-gray-100 pt-3">
                <div id="importantInfo" class="flex flex-col space-y-1">
                  <div class="text-red-700 font-bold" style="font-size: 16px;">
                    â˜… è«‹æ–¼ <span id="previewDeadline" class="underline decoration-double text-xl">10/23</span> ä¹‹å‰äº¤å›å­¸å‹™çµ„ â˜…
                  </div>
                  <div class="font-bold text-gray-700" style="font-size: 15px;">
                    è¯çµ¡é›»è©±ï¼š<span id="previewPhone" class="text-lg">(06)7880114</span>
                  </div>
                </div>

                <div class="text-right">
                  <div class="mb-3">å®¶é•·ç°½ç« ï¼š____________________</div>
                  <div class="font-bold text-lg"><span id="previewSchool2">å»ºåŠŸåœ‹å°</span> æ•™å°è™• æ•¬ä¸Š</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="pdfMount"></div>

  <script>
    let uploadedImageData = null;

    // é è¨­è³‡æ–™
    document.getElementById('activityIntro').value = `ç‚ºå¢é€²å­¸ç”Ÿå°å±±é‡ç’°å¢ƒçš„èªè­˜èˆ‡å°Šé‡ï¼Œé«”é©—æˆ¶å¤–ç”Ÿæ´»ä¹‹ç¾ï¼Œä¸¦é€éå¯¦ä½œèª²ç¨‹åŸ¹é¤Šå­¸ç”Ÿçš„åœ˜é«”åˆä½œç²¾ç¥èˆ‡è‡ªä¸»è§£æ±ºå•é¡Œä¹‹èƒ½åŠ›ã€‚`;
    document.getElementById('timeDesc').value = `11æœˆ13æ—¥(æ˜ŸæœŸå››) 08:00 å‡ºç™¼ï¼Œ11æœˆ14æ—¥(æ˜ŸæœŸäº”) 16:00 è¿”å›ã€‚`;
    document.getElementById('notes').value = `è«‹ç©¿è‘—é‹å‹•æœè£ä¸¦å‚™å¦¥æ›æ´—è¡£ç‰©ã€‚\næ”œå¸¶å€‹äººå¥ä¿å¡åŠå¿…å‚™è—¥å“ã€‚\nç‚ºè½å¯¦ç’°ä¿ï¼Œè«‹è‡ªå‚™å€‹äººç›¥æ´—ç”¨å…·åŠé£²æ°´æ¯ã€‚`;

    // æª”æ¡ˆè™•ç†
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('scheduleImage');
    uploadArea.onclick = () => fileInput.click();
    fileInput.onchange = (e) => {
      if (e.target.files.length > 0) {
        const reader = new FileReader();
        reader.onload = (ev) => { uploadedImageData = ev.target.result; document.getElementById('imagePreview').classList.remove('hidden'); updatePreview(); };
        reader.readAsDataURL(e.target.files[0]);
      }
    };

    function removeImage() { uploadedImageData = null; document.getElementById('imagePreview').classList.add('hidden'); fileInput.value = ''; updatePreview(); }

    function updatePreview() {
      document.getElementById('previewSchool').textContent = document.getElementById('schoolName').value;
      document.getElementById('previewSchool2').textContent = document.getElementById('schoolName').value;
      document.getElementById('previewActivity').textContent = document.getElementById('activityName').value;
      document.getElementById('replyActivity').textContent = document.getElementById('activityName').value;
      document.getElementById('previewIntro').textContent = document.getElementById('activityIntro').value;
      document.getElementById('previewTime').textContent = document.getElementById('timeDesc').value;
      document.getElementById('previewPhone').textContent = document.getElementById('phone').value;
      document.getElementById('previewDeadline').textContent = document.getElementById('deadline').value;

      const container = document.getElementById('scheduleImageContainer');
      container.innerHTML = '';
      if (uploadedImageData) {
        const img = document.createElement('img');
        img.src = uploadedImageData;
        img.style.width = document.getElementById('imgWidthRange').value + '%';
        img.className = 'border rounded shadow-sm';
        container.appendChild(img);
      } else {
        container.innerHTML = '<p class="text-gray-400 text-sm italic">æœªä¸Šå‚³åœ–ç‰‡</p>';
      }

      const notesList = document.getElementById('notesList');
      notesList.innerHTML = '';
      document.getElementById('notes').value.split('\n').filter(n => n.trim()).forEach(note => {
        const div = document.createElement('div');
        div.textContent = 'â—† ' + note;
        notesList.appendChild(div);
      });
    }

    // æ»‘æ¡¿ç›£è½
    document.getElementById('fontSizeRange').oninput = (e) => {
      const v = parseInt(e.target.value);
      document.getElementById('fsVal').textContent = v + 'px';
      document.getElementById('preview').style.fontSize = v + 'px';
      document.getElementById('previewTitle').style.fontSize = (v * 1.3) + 'px';
      document.getElementById('previewDeadline').parentElement.style.fontSize = (v + 2) + 'px';
      document.getElementById('previewPhone').parentElement.style.fontSize = (v + 1) + 'px';
    };

    document.getElementById('lineHeightRange').oninput = (e) => {
      const v = e.target.value / 10;
      document.getElementById('lhVal').textContent = v;
      document.querySelectorAll('.section-content').forEach(el => el.style.lineHeight = v);
      document.getElementById('notesList').style.lineHeight = v;
    };

    document.getElementById('imgWidthRange').oninput = (e) => {
      document.getElementById('imgWVal').textContent = e.target.value + '%';
      updatePreview();
    };

    ['schoolName', 'activityName', 'activityIntro', 'timeDesc', 'notes', 'phone', 'deadline'].forEach(id => {
      document.getElementById(id).addEventListener('input', updatePreview);
    });

    document.getElementById('downloadBtn').onclick = async function () {
      const btn = this;
      btn.disabled = true;
      btn.textContent = 'ç”¢ç”Ÿ PDF ä¸­...';

      const mount = document.getElementById('pdfMount');
      const clone = document.getElementById('preview').cloneNode(true);
      mount.innerHTML = '';
      mount.appendChild(clone);

      const opt = {
        margin: 0,
        filename: `${document.getElementById('activityName').value}_é€šçŸ¥å–®.pdf`,
        image: { type: 'jpeg', quality: 1.0 },
        html2canvas: { scale: 2, useCORS: true, scrollY: 0, scrollX: 0, windowScrolling: false },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };

      try { await html2pdf().set(opt).from(clone).save(); } catch (e) { alert('ä¸‹è¼‰å¤±æ•—'); } finally { mount.innerHTML = ''; btn.disabled = false; btn.textContent = 'ä¸‹è¼‰æ­£å¼ PDF é€šçŸ¥å–®'; }
    };

    updatePreview();
  </script>
</body>

</html>